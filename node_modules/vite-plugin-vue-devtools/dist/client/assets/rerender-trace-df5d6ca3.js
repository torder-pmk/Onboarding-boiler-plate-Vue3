import { v as defineComponent, a$ as ref, c5 as DevToolsHooks, r as resolveComponent, o as openBlock, e as createElementBlock, x as createBaseVNode, u as createVNode, h as withCtx, z as unref, c as createBlock, a9 as createTextVNode, g as createCommentVNode, F as Fragment, i as renderList, c6 as useDevToolsClient, c7 as rootPath, _ as __unplugin_components_7, c4 as __unplugin_components_1, p as pushScopeId, a as popScopeId, y as toDisplayString, bK as _export_sfc } from './index-36a8f2c8.js';
import { d as dayjs } from './dayjs.min-f03ccd82.js';
import { g as getInstanceName, a as getSetupStateInfo, t as toRaw } from './data-5bcd0de2.js';
import './_commonjsHelpers-7e83dbf2.js';

const _withScopeId = (n) => (pushScopeId("data-v-61b9e26e"), n = n(), popScopeId(), n);
const _hoisted_1 = {
  "h-full": "",
  "w-full": "",
  "of-auto": "",
  "n-panel-grids": ""
};
const _hoisted_2 = { "w-full": "" };
const _hoisted_3 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("p", {
  "text-xs": "",
  "op-50": ""
}, " Start Tracing ", -1));
const _hoisted_4 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("p", {
  "text-xs": "",
  "op-50": ""
}, " Clear ", -1));
const _hoisted_5 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("p", {
  "text-xs": "",
  "op-50": ""
}, " Capture rerender elements ", -1));
const _hoisted_6 = {
  key: 0,
  flex: "~ items-center justify-center",
  "h-screen": ""
};
const _hoisted_7 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("i", {
  class: "i-fluent:record-12-regular",
  text: "4.7",
  "cursor-pointer": "",
  "text-secondary": "",
  hover: "text-black dark:text-white"
}, null, -1));
const _hoisted_8 = [
  _hoisted_7
];
const _hoisted_9 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("p", { flex: "~ items-center" }, [
  /* @__PURE__ */ createTextVNode(" Click the clear button "),
  /* @__PURE__ */ createBaseVNode("span", {
    border: "~ base",
    "mx-1": "",
    "inline-flex": "",
    "items-center": "",
    "justify-center": "",
    p1: ""
  }, [
    /* @__PURE__ */ createBaseVNode("i", {
      class: "i-grommet-icons:clear",
      text: "3.8",
      "text-secondary": ""
    })
  ]),
  /* @__PURE__ */ createTextVNode(" to clear the results. ")
], -1));
const _hoisted_10 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("p", { flex: "~ items-center" }, [
  /* @__PURE__ */ createTextVNode(" Click the capture button "),
  /* @__PURE__ */ createBaseVNode("span", {
    border: "~ base",
    "mx-1": "",
    "inline-flex": "",
    "items-center": "",
    "justify-center": "",
    p1: ""
  }, [
    /* @__PURE__ */ createBaseVNode("i", {
      class: "i-tabler:capture",
      text: "3.8",
      "text-secondary": ""
    })
  ]),
  /* @__PURE__ */ createTextVNode(" to capture the rerender effect element. ")
], -1));
const _hoisted_11 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("p", { "lh-5": "" }, [
  /* @__PURE__ */ createTextVNode(" Start tracing, do something in the page. Then,"),
  /* @__PURE__ */ createBaseVNode("br"),
  /* @__PURE__ */ createTextVNode(" press the stop button to show the resulting triggers for page rerenders. ")
], -1));
const _hoisted_12 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("p", { class: "loading-animation" }, " Tracing... ", -1));
const _hoisted_13 = { key: 1 };
const _hoisted_14 = /* @__PURE__ */ _withScopeId(() => /* @__PURE__ */ createBaseVNode("thead", {
  border: "b r base",
  sticky: "",
  display: "table-header-group",
  "top-0": "",
  "z-10": ""
}, [
  /* @__PURE__ */ createBaseVNode("tr", { "bg-base": "" }, [
    /* @__PURE__ */ createBaseVNode("th", {
      "p-2": "",
      "text-center": ""
    }, " Component File "),
    /* @__PURE__ */ createBaseVNode("th", {
      "p-2": "",
      "text-center": ""
    }, " Key "),
    /* @__PURE__ */ createBaseVNode("th", {
      "p-2": "",
      "text-center": ""
    }, " Value "),
    /* @__PURE__ */ createBaseVNode("th", {
      "p-2": "",
      "text-center": ""
    }, " Data Type "),
    /* @__PURE__ */ createBaseVNode("th", {
      "p-2": "",
      "text-center": ""
    }, " Update Type "),
    /* @__PURE__ */ createBaseVNode("th", {
      "p-2": "",
      "text-center": ""
    }, " Update Time ")
  ])
], -1));
const _hoisted_15 = { border: "b r base" };
const _hoisted_16 = ["onClick"];
const _hoisted_17 = {
  "max-w-30": "",
  "w-30": "",
  "of-hidden": "",
  "text-ellipsis": "",
  "ws-nowrap": "",
  "px-2": "",
  "text-center": "",
  "text-sm": "",
  "font-mono": "",
  op70: ""
};
const _hoisted_18 = {
  "max-w-30": "",
  "w-30": "",
  "of-hidden": "",
  "text-ellipsis": "",
  "ws-nowrap": "",
  "px-2": "",
  "text-center": "",
  "text-sm": "",
  "font-mono": "",
  op70: ""
};
const _hoisted_19 = {
  "max-w-30": "",
  "w-30": "",
  "of-hidden": "",
  "text-ellipsis": "",
  "ws-nowrap": "",
  "px-2": "",
  "text-center": "",
  "text-sm": "",
  "font-mono": "",
  op70: ""
};
const _hoisted_20 = {
  "max-w-30": "",
  "w-30": "",
  "of-hidden": "",
  "text-ellipsis": "",
  "ws-nowrap": "",
  "px-2": "",
  "text-center": "",
  "text-sm": "",
  "font-mono": "",
  op70: ""
};
const _hoisted_21 = {
  "max-w-30": "",
  "w-30": "",
  "of-hidden": "",
  "text-ellipsis": "",
  "ws-nowrap": "",
  "px-2": "",
  "text-center": "",
  "text-sm": "",
  "font-mono": "",
  op70: ""
};
const _sfc_main = /* @__PURE__ */ defineComponent({
  __name: "rerender-trace",
  setup(__props) {
    const client = useDevToolsClient();
    const hook = client.value.hook;
    const isTracing = ref(false);
    const result = ref([]);
    const traceBuffer = ref([]);
    const highlightEnabled = ref(true);
    function normalizeEventInfo(e, instance) {
      const info = getSetupStateInfo(e.target);
      const file = instance.type.__file?.replace?.(rootPath, "") ?? "-";
      const dataType = info.computed ? "Computed" : info.ref ? "Ref" : info.reactive ? "Reactive" : null;
      const index = Object.values(instance.devtoolsRawSetupState).map((i) => toRaw(i)).indexOf(toRaw(e.target));
      const key = index === -1 ? e.key ?? "unknown" : Object.keys(instance.devtoolsRawSetupState)[index];
      const value = !dataType || info.reactive ? e.target[e.key] : e.target.value;
      return {
        componentFile: file,
        fullFilePath: instance.type.__file ?? "",
        key,
        value,
        dataType: dataType ?? "unknown",
        updateType: e.type ?? "-",
        updateTime: Date.now()
      };
    }
    hook.on(DevToolsHooks.RENDER_TRACKED, (e, instance) => {
      isTracing.value && traceBuffer.value.push(normalizeEventInfo(e, instance));
    });
    hook.on(DevToolsHooks.RENDER_TRIGGERED, (e, instance) => {
      if (isTracing.value) {
        traceBuffer.value.push(normalizeEventInfo(e, instance));
        if (highlightEnabled.value) {
          let el = null;
          const instanceEl = instance.vnode.el;
          if (instanceEl?.nodeType === Node.TEXT_NODE)
            el = instanceEl?.parentElement;
          else if (instanceEl?.nodeType === Node.ELEMENT_NODE)
            el = instanceEl;
          if (el)
            client.value.rerenderHighlight.updateInfo(instance.uid.toString(), getInstanceName(instance), el.getBoundingClientRect());
        }
      }
    });
    function start() {
      result.value = [];
      traceBuffer.value = [];
      isTracing.value = true;
    }
    function stop() {
      isTracing.value = false;
      const typeOrder = { Ref: 0, Computed: 1 };
      result.value = traceBuffer.value.sort((a, b) => typeOrder[a.dataType] - typeOrder[b.dataType]).sort((a, b) => a.updateTime - b.updateTime);
      traceBuffer.value = [];
    }
    function clear() {
      if (isTracing.value)
        return;
      result.value = [];
    }
    function openInEditor(filePath) {
      if (!filePath)
        return;
      client.value.openInEditor(filePath);
    }
    return (_ctx, _cache) => {
      const _component_VTooltip = resolveComponent("VTooltip");
      const _component_VDCard = __unplugin_components_7;
      const _component_VDBadge = __unplugin_components_1;
      return openBlock(), createElementBlock("div", _hoisted_1, [
        createBaseVNode("div", _hoisted_2, [
          createVNode(_component_VDCard, {
            flex: "~ col gap-2",
            absolute: "",
            "right-3": "",
            "top-3": "",
            "z-20": "",
            p1: ""
          }, {
            default: withCtx(() => [
              createVNode(_component_VTooltip, {
                placement: "bottom",
                distance: 12,
                "text-center": ""
              }, {
                popper: withCtx(() => [
                  _hoisted_3
                ]),
                default: withCtx(() => [
                  !unref(isTracing) ? (openBlock(), createElementBlock("i", {
                    key: 0,
                    class: "i-fluent:record-12-regular",
                    text: "4.7",
                    "cursor-pointer": "",
                    "text-secondary": "",
                    hover: "text-black dark:text-white",
                    onClick: start
                  })) : (openBlock(), createElementBlock("i", {
                    key: 1,
                    class: "i-fluent:record-stop-12-regular",
                    text: "4.7",
                    "cursor-pointer": "",
                    "text-red-600": "",
                    hover: "text-red-800",
                    onClick: stop
                  }))
                ]),
                _: 1
              }),
              createVNode(_component_VTooltip, {
                placement: "bottom",
                distance: 12,
                "text-center": ""
              }, {
                popper: withCtx(() => [
                  _hoisted_4
                ]),
                default: withCtx(() => [
                  createBaseVNode("i", {
                    class: "i-grommet-icons:clear",
                    text: "3.8",
                    "cursor-pointer": "",
                    "text-secondary": "",
                    hover: "text-black dark:text-white",
                    onClick: clear
                  })
                ]),
                _: 1
              }),
              createVNode(_component_VTooltip, {
                placement: "bottom",
                distance: 12,
                "text-center": ""
              }, {
                popper: withCtx(() => [
                  _hoisted_5
                ]),
                default: withCtx(() => [
                  !unref(highlightEnabled) ? (openBlock(), createElementBlock("i", {
                    key: 0,
                    class: "i-tabler:capture",
                    text: "4.7",
                    "cursor-pointer": "",
                    "text-secondary": "",
                    hover: "text-black dark:text-white",
                    onClick: _cache[0] || (_cache[0] = ($event) => highlightEnabled.value = true)
                  })) : (openBlock(), createElementBlock("i", {
                    key: 1,
                    class: "i-tabler:capture",
                    text: "4.7",
                    "cursor-pointer": "",
                    "text-green-600": "",
                    hover: "text-green-800",
                    onClick: _cache[1] || (_cache[1] = ($event) => highlightEnabled.value = false)
                  }))
                ]),
                _: 1
              })
            ]),
            _: 1
          }),
          !unref(result).length ? (openBlock(), createElementBlock("div", _hoisted_6, [
            !unref(isTracing) && !unref(result).length ? (openBlock(), createBlock(_component_VDCard, {
              key: 0,
              flex: "~ col gap2",
              relative: "",
              p3: "",
              op60: ""
            }, {
              default: withCtx(() => [
                createBaseVNode("p", { flex: "~ items-center" }, [
                  createTextVNode(" Click the start button "),
                  createBaseVNode("button", {
                    border: "~ base",
                    "mx-1": "",
                    "inline-flex": "",
                    "items-center": "",
                    "justify-center": "",
                    p: "0.5",
                    onClick: start
                  }, _hoisted_8),
                  createTextVNode(" to start a new tracing. ")
                ]),
                _hoisted_9,
                _hoisted_10,
                _hoisted_11,
                createVNode(_component_VDBadge, {
                  absolute: "",
                  "right--0.5": "",
                  "top-0": "",
                  "rounded-0": "",
                  "bg-green-400:10": "",
                  "text-green-400": "",
                  title: "Experimental",
                  textContent: "Experimental"
                })
              ]),
              _: 1
            })) : unref(isTracing) && !unref(result).length ? (openBlock(), createBlock(_component_VDCard, {
              key: 1,
              flex: "~ col gap2",
              p3: ""
            }, {
              default: withCtx(() => [
                _hoisted_12
              ]),
              _: 1
            })) : createCommentVNode("", true)
          ])) : createCommentVNode("", true),
          unref(result).length && !unref(isTracing) ? (openBlock(), createElementBlock("table", _hoisted_13, [
            _hoisted_14,
            createBaseVNode("tbody", _hoisted_15, [
              (openBlock(true), createElementBlock(Fragment, null, renderList(unref(result), (item, index) => {
                return openBlock(), createElementBlock("tr", {
                  key: index,
                  class: "group",
                  "h-7": "",
                  border: "b dashed transparent hover:base"
                }, [
                  createBaseVNode("td", {
                    "max-w-50": "",
                    "cursor-pointer": "",
                    "of-hidden": "",
                    "text-ellipsis": "",
                    "px-2": "",
                    "text-center": "",
                    "text-sm": "",
                    underline: "",
                    op70: "",
                    hover: "text-primary",
                    onClick: ($event) => openInEditor(item.fullFilePath)
                  }, toDisplayString(item.componentFile), 9, _hoisted_16),
                  createBaseVNode("td", _hoisted_17, toDisplayString(item.key), 1),
                  createBaseVNode("td", _hoisted_18, toDisplayString(item.value), 1),
                  createBaseVNode("td", _hoisted_19, toDisplayString(item.dataType), 1),
                  createBaseVNode("td", _hoisted_20, toDisplayString(item.updateType), 1),
                  createBaseVNode("td", _hoisted_21, toDisplayString(unref(dayjs)(item.updateTime).format("HH:mm:ss")), 1)
                ]);
              }), 128))
            ])
          ])) : createCommentVNode("", true)
        ])
      ]);
    };
  }
});

/* Injected with object hook! */

/* unplugin-vue-components disabled */const rerenderTrace_vue_vue_type_style_index_0_scoped_61b9e26e_lang = '';
/* Injected with object hook! */

const rerenderTrace = /* @__PURE__ */ _export_sfc(_sfc_main, [["__scopeId", "data-v-61b9e26e"]]);

/* Injected with object hook! */

export { rerenderTrace as default };
